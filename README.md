## æœºå™¨é˜…è¯»ç†è§£ä»£ç åŠé¢„è®­ç»ƒæ¨¡å‹å¼€æºåˆ†äº«


***************************************************** **æ›´æ–°** *****************************************************
* 5/21ï¼š**å¼€æºåŸºäºå¤§è§„æ¨¡MRCæ•°æ®å†è®­ç»ƒ**çš„æ¨¡å‹ï¼ˆåŒ…æ‹¬`roberta-wwm-large`ã€`macbert-large`ã€`albert-xxlarge`ã€`albert-xlarge`ï¼‰
* 5/18ï¼šå¼€æºä»£ç 


## Contents
  - [ä»“åº“ä»‹ç»](#ä»“åº“ä»‹ç»)
  - [è¿è¡Œæµç¨‹](#è¿è¡Œæµç¨‹)
  - [å°å°æç¤º](#å°å°æç¤º)
  - [åŸºäºå¤§è§„æ¨¡MRCæ•°æ®ï¼ˆç™¾ä¸‡ï¼‰å†è®­ç»ƒçš„æ¨¡å‹å‘å¸ƒ](#åŸºäºå¤§è§„æ¨¡MRCæ•°æ®å†è®­ç»ƒ)
  - [ç›¸å…³æ¯”èµ›](#ç›¸å…³æ¯”èµ›)


## ä»“åº“ä»‹ç»
* **ä¼˜åŒ–**
  * ä»£ç åŸºäºHugginfaceçš„squadä»£ç ã€‚ä¹‹å‰è‡ªå·±å¼€å‘ï¼Œè¿­ä»£ç‰ˆæœ¬å¤šï¼Œä¸”å¾ˆå¤šç»†èŠ‚æ²¡æœ‰è€ƒè™‘åˆ°ï¼ˆå¦‚ï¼šç©ºæ ¼ã€ç‰¹æ®Šå­—ç¬¦ã€æ»‘çª—åç­”æ¡ˆçš„ç§»åŠ¨ç­‰å¤„ç†ï¼‰ï¼Œ
    ç´¢æ€§å°±ç›´æ¥åœ¨Hugginfaceçš„squadä»£ç ä¸Šè¿­ä»£ã€‚ä½†å…¶å®ç°çš„ç±»ç¼ºä¹å¯¹ä¸­æ–‡çš„æ”¯æŒï¼Œæ¨ç†ç»“æœæœ‰ä¸€äº›å½±å“ï¼Œ**ä¿®æ”¹ä¹‹å æ­¤åº“èƒ½è¾ƒå¥½çš„æ”¯æŒä¸­æ–‡ï¼ŒæŠ½å–çš„ç­”æ¡ˆç²¾åº¦ä¹Ÿå°½å¯èƒ½ä¸å—å½±å“**
* **ç”±æ¥**
  * æ­¤ä»“åº“æ¥æºäºæˆ‘2019å¹´å‚åŠ Dureaderæ¯”èµ›çš„ä»£ç åº“ï¼Œä¹‹åå°±åœ¨æ­¤åº“ä¸Šå¼€æºæˆ‘å‚åŠ å„ç§ä¸­æ–‡æœºå™¨é˜…è¯»ç†è§£ï¼ˆMRCï¼‰æ¯”èµ›çš„æ–¹æ¡ˆå’Œä»£ç  [ç›¸å…³æ¯”èµ›](#ç›¸å…³æ¯”èµ›)
* **ç›®çš„**
  * "æ•£æˆ·"çš„æˆ‘ä¸Šåˆ†å›°éš¾ğŸ˜°ï¼Œæ‰€ä»¥è¿™ä¸ªåº“æ—¨åœ¨ä¸ºå¤§å®¶æä¾›ä¸€ä¸ªæ•ˆæœä¸é”™çš„`å¼ºåŸºçº¿`ã€‚å¤§å®¶å¯ä»¥åœ¨è¿™åŸºç¡€ä¸Šæ”¹è¿›ï¼Œä¹Ÿå¯ä»¥å€Ÿé‰´èåˆè¿›è‡ªå·±çš„æ–¹æ³•
  * å…¶æ¬¡ï¼Œæˆ‘å¼€æºäº†å¤šä¸ªåŸºäºæœºå™¨é˜…è¯»ç†è§£æ•°æ®ï¼ˆç™¾ä¸‡ï¼‰è®­ç»ƒåçš„æ¨¡å‹ï¼Œåœ¨MRCä»»åŠ¡ä¸‹å¾®è°ƒï¼Œæ•ˆæœå¤§å¹…ä¼˜äºä½¿ç”¨é¢„è®­ç»ƒçš„è¯­è¨€æ¨¡å‹
  * æœ‰äº›ç”±äº"å¹´ä»£ä¹…è¿œ"ä¹Ÿæ•´ç†ä¸è¿‡æ¥äº†ï¼ˆ`others`æ–‡ä»¶å¤¹ä¸‹çš„æ¯”èµ›ï¼‰ã€‚ä¸è¿‡æ–¹æ¡ˆå’Œä»£ç éƒ½æœ‰ï¼Œå¯¹æ¯”ç€çœ‹å¾ˆå®¹æ˜“å°±çœ‹æ‡‚äº†


## è¿è¡Œæµç¨‹

è„šæœ¬å‚æ•°è§£é‡Š

* `--lm`: è¦åŠ è½½çš„æ¨¡å‹çš„æ–‡ä»¶å¤¹åç§°
* `--do_train`: å¼€å¯è®­ç»ƒ
* `--evaluate_during_training`: å¼€å¯è®­ç»ƒçš„æ—¶å€™éªŒè¯
* `--do_test`:  å¼€å¯é¢„æµ‹
* `--version_2_with_negative`: å¼€å¯é€‚é…äºæ•°æ®ä¸­æœ‰æ— ç­”æ¡ˆæ•°æ®ï¼ˆå¦‚ï¼šsquad2.0ã€dureader2021ï¼‰
* `--threads`: æ•°æ®å¤„ç†æ‰€ä½¿ç”¨çš„çº¿ç¨‹æ•°ï¼ˆå¯ä»¥é€šè¿‡os.cpu_count()æŸ¥çœ‹æœºå™¨æ”¯æŒçš„çº¿ç¨‹æ•°ï¼‰
  
##### ä¸€ã€æ•°æ® & æ¨¡å‹ï¼š
* å°†trainã€devã€testç­‰æ•°æ®æ”¾åœ¨datasetsæ–‡ä»¶å¤¹ä¸‹ ([æ ¼å¼ç¬¦åˆsquadçš„å°±è¡Œ](https://aistudio.baidu.com/aistudio/competition/detail/66))
* é€šè¿‡ export lm=xxx æŒ‡å®šæ¨¡å‹ç›®å½•

##### äºŒã€ä¸€é”®è¿è¡Œ
```
cd main
```
```
sh train_bert.sh
```
```
sh test_bert.sh
```

##### ä¸‰ã€æ— ç­”æ¡ˆé—®é¢˜
* å¦‚æœåŒ…å«æ— ç­”æ¡ˆç±»å‹æ•°æ®ï¼ˆå¦‚ï¼šsquad2.0ã€dureader2021ï¼‰ï¼ŒåŠ å…¥--version_2_with_negativeå°±è¡Œ
* å°†æ•°æ®æ›¿æ¢ä¸ºDureader2021_checklistçš„æ•°æ®å¯ä»¥ç›´æ¥è·‘


## å°å°æç¤ºï¼š
* ä»£ç ä¸Šä¼ å‰å·²ç»è·‘é€šã€‚æ–‡ä»¶ä¸å¤šï¼Œæ‰€ä»¥å¦‚æœç¢°åˆ°æŠ¥é”™ä¹‹ç±»çš„ä¿¡æ¯ï¼Œå¯èƒ½æ˜¯ä»£ç è·¯å¾„ä¸å¯¹ã€ç¼ºå°‘å®‰è£…åŒ…ç­‰é—®é¢˜ï¼Œä¸€æ­¥æ­¥è§£å†³ï¼Œå¯ä»¥æissue
* æ‹¿æ­¤åº“å‘å¸ƒçš„å†è®­ç»ƒæ¨¡å‹ï¼ŒåŸºäºè¿™å¥—ä»£ç å¾®è°ƒå¯ä»¥æœ‰ä¸€ä¸ªå¾ˆé«˜çš„åŸºçº¿ï¼Œå·²æœ‰å°ä¼™ä¼´åœ¨Dureader2021æ¯”èµ›ä¸­å–å¾—**top10**çš„æˆç»©äº†ğŸ˜
* **ç¯å¢ƒ**
  ```
  pip install transformers==2.10.0 
  ```

## åŸºäºå¤§è§„æ¨¡MRCæ•°æ®å†è®­ç»ƒ

* æ•°æ®æ¥æºï¼ˆç™¾ä¸‡è§„æ¨¡ï¼‰
  * ç½‘ä¸Šæ”¶é›†çš„å¤§é‡ä¸­æ–‡MRCæ•°æ®
  ï¼ˆå…¶ä¸­åŒ…æ‹¬ Dureaderã€WebQAã€SogoQAã€Squad-2.0ã€CMRC-2018ã€æ³•ç ”æ¯ã€å†›äº‹é˜…è¯»ç†è§£ã€EpidemicQAä»¥åŠè‡ªå·±çˆ¬å–çš„ç½‘é¡µæ•°æ®ç­‰ï¼Œ
  è¿™é‡Œé¢åŒ…æ‹¬äº†ç™¾åº¦ç™¾ç§‘ã€æœç‹—æœç´¢ã€å†›äº‹ã€æ³•å¾‹ã€åŒ»ç–—ã€æ•™è‚²ç­‰é¢†åŸŸã€‚ï¼‰

* è®­ç»ƒæ•°æ®æ„é€ 
  * è¿‡æ»¤
    * å¯¹äºæ‰€æœ‰æ•°æ®ï¼šcontext>512çš„èˆå¼ƒã€question>32çš„èˆå¼ƒã€answerä¸æ˜¯ç™¾åˆ†ç™¾å‡ºç°åœ¨æ–‡æ¡£ä¸­çš„èˆå¼ƒã€ç½‘é¡µæ ‡ç­¾å æ¯”è¶…è¿‡30%çš„èˆå¼ƒã€‚
  * æ ‡æ³¨
    * å¯¹äºåªæœ‰ç­”æ¡ˆæ²¡æœ‰ä½ç½®æ ‡ç­¾çš„æ•°æ®è¿›è¡Œä½ç½®æ ‡æ³¨ï¼šè‹¥ç­”æ¡ˆå¤šæ¬¡å‡ºç°åœ¨æ–‡æ¡£ä¸­ï¼Œåˆ™é€‰æ‹©ä¸Šä¸‹æ–‡ä¸é—®é¢˜æœ€ç›¸ä¼¼çš„ç­”æ¡ˆç‰‡æ®µä½œä¸ºæ ‡ç­¾ç­”æ¡ˆï¼ˆä½¿ç”¨F1æ¥è®¡ç®—ç›¸ä¼¼åº¦ï¼‰ï¼Œè‹¥ç­”æ¡ˆåªå‡ºç°ä¸€æ¬¡ï¼Œåˆ™ç›´æ¥é»˜è®¤è¯¥ç­”æ¡ˆä¸ºæ ‡ç­¾ç­”æ¡ˆã€‚
  * æ— ç­”æ¡ˆæ•°æ®ï¼ˆæ­£æ ·æœ¬ : è´Ÿæ ·æœ¬ = 1 : 1ï¼‰
    * å¯¹äºæ¯ä¸€ä¸ªé—®é¢˜ï¼Œéšæœºä»æ•°æ®ä¸­æå–contextï¼Œå¹¶ä¿ç•™å¯¹åº”çš„title;ï¼ˆ50%ï¼‰
    * å¯¹äºæ¯ä¸€ä¸ªé—®é¢˜ï¼Œä½¿ç”¨BM25ç®—æ³•å¬å›å¾—åˆ†æœ€é«˜çš„å‰åä¸ªæ–‡æ¡£ï¼Œç„¶åæ ¹æ®å¾—åˆ†é‡‡æ ·å‡ºä¸€ä¸ªcontextä½œä¸ºè´Ÿæ ·æœ¬ã€‚å¯¹äºéå®ä½“ç±»ç­”æ¡ˆï¼Œå‰”é™¤å¾—åˆ†æœ€é«˜çš„contextï¼ˆ50%ï¼‰
* ç”¨é€”  
  * æ­¤mrcæ¨¡å‹å¯ç›´æ¥ç”¨äº`open domain`ï¼Œ[ç‚¹å‡»ä½“éªŒ](https://huggingface.co/luhua/chinese_pretrain_mrc_roberta_wwm_ext_large)
  * å°†æ­¤mrcæ¨¡å‹æ”¾åˆ°ä¸‹æ¸¸ä»»åŠ¡å¾®è°ƒå¯æ¯”ç›´æ¥ä½¿ç”¨é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹æé«˜`3ä¸ªç‚¹`ä»¥ä¸Šï¼ˆDureaderä¸Šçš„çš„å®éªŒç»“æœï¼Œå…¶ä»–æ•°æ®é›†è¿˜æ²¡å…·ä½“æµ‹è¯•ï¼‰
* **å•†åŠ¡åˆä½œ**
  * ç›¸å…³è®­ç»ƒæ•°æ®ä»¥åŠä½¿ç”¨æ›´å¤šæ•°æ®è®­ç»ƒçš„æ¨¡å‹å¯é‚®ç®±è”ç³»~ 

```
åŸºäºæ­¤åº“ä»£ç å‘å¸ƒçš„å†è®­ç»ƒæ¨¡å‹ï¼Œåœ¨dureader2021 Aæ¦œçš„è¯¦ç»†æ•ˆæœå¯¹æ¯”
+-----------------------------------------------+
|                                       |  F1   |
+-----------------------------------------------+
| macbert-large (åŸºäºå“ˆå·¥å¤§é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹)  | 65.x  |
+-----------------------------------------------+
| macbert-large                         | 68.13 |
+-----------------------------------------------+
| roberta-wwm-ext-large                 | 66.91 |
+-----------------------------------------------+
| albert-xlargee                        | 65.24 |
+-----------------------------------------------+
| xlabert-xxlarge                       | 65.79 |
+-----------------------------------------------+
```
```
----- ä½¿ç”¨æ–¹æ³• -----
from transformers import AutoTokenizer, AutoModelForQuestionAnswering

model_name = "chinese_pretrain_mrc_roberta_wwm_ext_large" # "chinese_pretrain_mrc_macbert_large"

# Use in Transformers
tokenizer = AutoTokenizer.from_pretrained(f"luhua/{model_name}")
model = AutoModelForQuestionAnswering.from_pretrained(f"luhua/{model_name}")

# Use locallyï¼ˆé€šè¿‡ https://huggingface.co/luhua ä¸‹è½½æ¨¡å‹åŠé…ç½®æ–‡ä»¶ï¼‰
tokenizer = BertTokenizer.from_pretrained(f'./{model_name}')
model = AutoModelForQuestionAnswering.from_pretrained(f'./{model_name}')
```

## ç›¸å…³æ¯”èµ›

* **Dureader checklist 2021è¯­è¨€ä¸æ™ºèƒ½æŠ€æœ¯ç«èµ›**
* **ç–«æƒ…æ”¿åŠ¡é—®ç­”åŠ©æ‰‹**ï¼ˆç¬¬ä¸€ï¼‰
* **Dureader robust 2020è¯­è¨€ä¸æ™ºèƒ½æŠ€æœ¯ç«èµ›**ï¼ˆç¬¬äºŒï¼‰
* **æˆè¯­é˜…è¯»ç†è§£**ï¼ˆç¬¬äºŒï¼‰
* **è±æ–¯æ¯**ï¼ˆç¬¬ä¸‰ï¼‰
* **Dureader 2019è¯­è¨€ä¸æ™ºèƒ½æŠ€æœ¯ç«èµ›**ï¼ˆç¬¬ä¸ƒï¼‰